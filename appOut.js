var Calculator;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=e}(Calculator||(Calculator={}));var Calculator;!function(t){!function(t){t[t.high=0]="high",t[t.low=1]="low"}(t.CircleCrossMode||(t.CircleCrossMode={}));var e=(t.CircleCrossMode,function(){function e(){}return e.prototype.circleCross=function(e,i,n,a,r){var s=this.length(i,n),o=Math.atan2(n.y-i.y,n.x-i.x),h=Math.acos(s/(2*a)),c=new t.Point(i.x+a*Math.cos(o+h),i.y+a*Math.sin(o+h)),l=new t.Point(i.x+a*Math.cos(o-h),i.y+a*Math.sin(o-h));return 0==r?this.length(e,c)>this.length(e,l)?this.length(e,c):this.length(e,l):1==r?this.length(e,c)<this.length(e,l)?this.length(e,c):this.length(e,l):void 0},e.prototype.length=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e.prototype.distPointLine=function(e,i,n){var a=new t.Point(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2);return this.length(e,a)},e}());t.EuclideanService=e}(Calculator||(Calculator={}));var Calculator;!function(t){var e=function(){function t(){}return t.prototype.period=function(t,e,i){return 2*Math.PI*Math.sqrt(Math.pow(t+e,3)/i)},t.prototype.nightTime=function(t,e,i){var n=t+e;return 2*Math.pow(n,2)/Math.sqrt(n*i)*Math.asin(t/n)},t.prototype.hohmannStartDV=function(t,e,i,n){var a=t+e,r=t+i;return Math.sqrt(n/a)*(Math.sqrt(2*r/(a+r))-1)},t.prototype.hohmannFinishDV=function(t,e,i,n){var a=t+e,r=t+i;return Math.sqrt(n/r)*(1-Math.sqrt(2*a/(a+r)))},t.prototype.slidePhaseAngle=function(t,e,i){return t/(1-e/i)},t}();t.OrbitalService=e}(Calculator||(Calculator={}));var Calculator;!function(t){angular.module("calc",[]).service("calc.euclideanServ",t.EuclideanService).service("calc.orbitalServ",t.OrbitalService)}(Calculator||(Calculator={}));var App;!function(t){var e=function(){function t(){}return t.omni="0",t.dish="1",t}();t.AntennaType=e}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i,n,a,r,s){this.$cookieStore=t,this.localStorage=e,this.dataKey=n,this.versionKey=a,this.modelVersion=r;var o=this.load(s);this._data=o?o:i,this.localStorage.set(this.versionKey,this.modelVersion)}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.load=function(t){var e=this.localStorage.get(this.dataKey);e||(e=this.$cookieStore.get(this.dataKey),this.$cookieStore.remove(this.dataKey));var i=this.localStorage.get(this.versionKey);return e?t(e,i):void 0},t.prototype.save=function(){Object.keys(this.data).length>0?this.localStorage.set(this.dataKey,this.data):this.localStorage.remove(this.dataKey)},t}();t.DataService=e}(App||(App={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},App;!function(t){var e=function(t){function e(e,i,n,a,r,s,o,h){t.call(this,e,i,a,r,s,o,h),this._static=n,this._dynamic=this.data}return __extends(e,t),Object.defineProperty(e.prototype,"static",{get:function(){return this._static},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamic",{get:function(){return this._dynamic},enumerable:!0,configurable:!0}),e}(t.DataService);t.DuplexDataService=e}(App||(App={}));var App;!function(t){var e=Calculator.Point,i=function(){function t(){}return Object.defineProperty(t.prototype,"center",{get:function(){return new e(this.realSize/2,this.realSize/2)},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,i){this.stage=new createjs.Stage(t),this.shapeContainer=new createjs.Container,this.textContainer=new createjs.Container,this.stage.addChild(this.shapeContainer),this.stage.addChild(this.textContainer),this.virtualSize=e,this.realSize=i},t.prototype.toReal=function(t){return t*this.realSize/this.virtualSize},t.prototype.update=function(){this.stage.update()},t.fontSetNormal="16px Arial",t.fontSetBig="20px Arial",t.localeSetting={maximumFractionDigits:3},t.marginText=8,t.marginTextPushed=24,t.strokeLineWidth=1,t.dotRadius=4,t.arrowSize=16,t}();t.ViewService=i}(App||(App={}));var App;!function(t){var e=function(e){function i(n,a){e.call(this,n,a,{"Reflectron DP-10":{name:"Reflectron DP-10",type:t.AntennaType.omni,range:500,elcNeeded:.01},"Communotron 16":{name:"Communotron 16",type:t.AntennaType.omni,range:2500,elcNeeded:.13},"CommTech EXP-VR-2T":{name:"CommTech EXP-VR-2T",type:t.AntennaType.omni,range:3e3,elcNeeded:.18},"Communotron 32":{name:"Communotron 32",type:t.AntennaType.omni,range:5e3,elcNeeded:.6},"Comms DTS-M1":{name:"Comms DTS-M1",type:t.AntennaType.dish,range:5e4,elcNeeded:.82},"Reflectron KR-7":{name:"Reflectron KR-7",type:t.AntennaType.dish,range:9e4,elcNeeded:.82},"Communotron 88-88":{name:"Communotron 88-88",type:t.AntennaType.dish,range:4e7,elcNeeded:.93},"Reflectron KR-14":{name:"Reflectron KR-14",type:t.AntennaType.dish,range:6e7,elcNeeded:.93},"CommTech-1":{name:"CommTech-1",type:t.AntennaType.dish,range:35e7,elcNeeded:2.6},"Reflectron GX-128":{name:"Reflectron GX-128",type:t.AntennaType.dish,range:4e8,elcNeeded:2.8},"RSS Reflectron DP-10":{name:"RSS Reflectron DP-10",type:t.AntennaType.omni,range:1e9,elcNeeded:.005},"RSS Communotron 16":{name:"RSS Communotron 16",type:t.AntennaType.omni,range:4e9,elcNeeded:.002},"RSS CommTech EXP-VR-2T":{name:"RSS CommTech EXP-VR-2T",type:t.AntennaType.omni,range:1e10,elcNeeded:.02},"RSS Communotron 32":{name:"RSS Communotron 32",type:t.AntennaType.omni,range:8e9,elcNeeded:.004},"RSS Comms DTS-M1":{name:"RSS Comms DTS-M1",type:t.AntennaType.dish,range:4e5,elcNeeded:.02},"RSS Reflectron KR-7":{name:"RSS Reflectron KR-7",type:t.AntennaType.dish,range:2e8,elcNeeded:.18},"RSS Communotron 88-88":{name:"RSS Communotron 88-88",type:t.AntennaType.dish,range:15e8,elcNeeded:.35},"RSS Reflectron KR-14":{name:"RSS Reflectron KR-14",type:t.AntennaType.dish,range:1e9,elcNeeded:.2},"RSS CommTech-1":{name:"RSS CommTech-1",type:t.AntennaType.dish,range:4e9,elcNeeded:.2},"RSS Reflectron GX-128":{name:"RSS Reflectron GX-128",type:t.AntennaType.dish,range:8e9,elcNeeded:.65}},{},i.dataKey,i.versionKey,i.modelVersion,i.updater),this._stockAntennas=this["static"],this._userAntennas=this.dynamic}return __extends(i,e),Object.defineProperty(i.prototype,"stockAntennas",{get:function(){return this._stockAntennas},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"userAntennas",{get:function(){return this._userAntennas},enumerable:!0,configurable:!0}),i.prototype.clone=function(t){return{name:t.name,type:t.type,range:t.range,elcNeeded:t.elcNeeded}},i.prototype.get=function(t){return-1!==Object.keys(this.stockAntennas).indexOf(t)?this.clone(this.stockAntennas[t]):-1!==Object.keys(this.userAntennas).indexOf(t)?this.clone(this.userAntennas[t]):void 0},i.prototype.set=function(t,e){this.userAntennas[t]=this.clone(e)},i.prototype.remove=function(t){delete this.userAntennas[t]},i.updater=function(t,e){if(void 0===e)for(var i in t)0==t[i].type?t[i].type="0":1==t[i].type&&(t[i].type="1");return t},i.dataKey="userAntenna",i.versionKey="userAntennaVersion",i.modelVersion=1,i.$inject=["$cookieStore","localStorageService"],i}(t.DuplexDataService);t.AntennaDictionaryService=e}(App||(App={}));var App;!function(t){var e=function(t){function e(i,n){t.call(this,i,n,{Kerbol:{name:"Kerbol",color:"rgb(255,242,0)",radius:261600,stdGravity:1172332800,soi:Number.POSITIVE_INFINITY},Moho:{name:"Moho",color:"rgb(185,122,87)",radius:250,stdGravity:168.60938,soi:9646.663},Eve:{name:"Eve",color:"rgb(163,73,164)",radius:700,stdGravity:8171.7302,soi:85109.365},Gilly:{name:"Gilly",color:"rgb(239,228,176)",radius:13,stdGravity:.0082894498,soi:126.12327},Kerbin:{name:"Kerbin",color:"rgb(63,111,40)",radius:600,stdGravity:3531.6,soi:84159.286},Mun:{name:"Mun",color:"rgb(127,127,127)",radius:200,stdGravity:65.138398,soi:2429.5591},Minmus:{name:"Minmus",color:"rgb(153,217,234)",radius:60,stdGravity:1.7658,soi:2247.4284},Duna:{name:"Duna",color:"rgb(237,28,36)",radius:320,stdGravity:301.36321,soi:47921.949},Ike:{name:"Ike",color:"rgb(127,127,127)",radius:130,stdGravity:18.568369,soi:1049.5989},Dres:{name:"Dres",color:"rgb(195,195,195)",radius:138,stdGravity:21.484489,soi:32832.84},Jool:{name:"Jool",color:"rgb(92,231,58)",radius:6e3,stdGravity:282528,soi:2455985.2},Laythe:{name:"Laythe",color:"rgb(25,55,98)",radius:500,stdGravity:1962,soi:3723.6458},Vall:{name:"Vall",color:"rgb(82,133,141)",radius:300,stdGravity:207.4815,soi:2406.4014},Tylo:{name:"Tylo",color:"rgb(195,195,195)",radius:600,stdGravity:4523.8934,soi:10856.518},Bop:{name:"Bop",color:"rgb(142,106,51)",radius:65,stdGravity:2.4868349,soi:1221.0609},Pol:{name:"Pol",color:"rgb(206,211,1)",radius:44,stdGravity:.72170208,soi:1042.1389},Eeloo:{name:"Eeloo",color:"rgb(221,221,210)",radius:210,stdGravity:74.410815,soi:119082.94},Mercury:{name:"Mercury",color:"rgb(185,122,87)",radius:2439,stdGravity:22026,soi:112410},Venus:{name:"Venus",color:"rgb(163,73,164)",radius:6051,stdGravity:324670,soi:616210},Earth:{name:"Earth",color:"rgb(63,111,40)",radius:6371,stdGravity:398600,soi:923895},Moon:{name:"Moon",color:"rgb(127,127,127)",radius:1737,stdGravity:4900,soi:66167},Mars:{name:"Mars",color:"rgb(237,28,36)",radius:3380,stdGravity:42811,soi:577231},Phobos:{name:"Phobos",color:"rgb(142,106,51)",radius:7,stdGravity:715e-6,soi:27},Deimos:{name:"Deimos",color:"rgb(239,228,176)",radius:5.456,stdGravity:98716e-9,soi:25},Jupiter:{name:"Jupiter",color:"rgb(92,231,58)",radius:69911,stdGravity:127e6,soi:48190353},Io:{name:"Io",color:"rgb(206,211,1)",radius:1811,stdGravity:5957.6,soi:7841},Europa:{name:"Europa",color:"rgb(221,221,210)",radius:1550,stdGravity:3201.5,soi:9728},Ganymede:{name:"Ganymede",color:"rgb(195,195,195)",radius:2624,stdGravity:9884.3,soi:10856.518},Callisto:{name:"Callisto",color:"rgb(127,127,127)",radius:2409,stdGravity:7176.5,soi:37706},Saturn:{name:"Saturn",color:"rgb(195,195,195)",radius:60268,stdGravity:379e5,soi:54468720},Titan:{name:"Titan",color:"rgb(25,55,98)",radius:2566,stdGravity:8972.5,soi:43324},Uranus:{name:"Uranus",color:"rgb(153,217,234)",radius:25559,stdGravity:579e4,soi:51686225},Pluto:{name:"Pluto",color:"rgb(82,133,141)",radius:1143,stdGravity:870.44,soi:3116132}},{},e.dataKey,e.versionKey,e.modelVersion,e.updater),this._stockBodies=this["static"],this._userBodies=this.dynamic}return __extends(e,t),Object.defineProperty(e.prototype,"stockBodies",{get:function(){return this._stockBodies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userBodies",{get:function(){return this._userBodies},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){return{name:t.name,color:t.color,radius:t.radius,stdGravity:t.stdGravity,soi:t.soi}},e.prototype.get=function(t){return-1!==Object.keys(this.stockBodies).indexOf(t)?this.clone(this.stockBodies[t]):-1!==Object.keys(this.userBodies).indexOf(t)?this.clone(this.userBodies[t]):void 0},e.prototype.set=function(t,e){this.userBodies[t]=this.clone(e)},e.prototype.remove=function(t){delete this.userBodies[t]},e.updater=function(t){return t},e.dataKey="userBody",e.versionKey="userBodyVersion",e.modelVersion=1,e.$inject=["$cookieStore","localStorageService"],e}(t.DuplexDataService);t.BodyDictionaryService=e}(App||(App={}));var App;!function(t){var e=function(e){function i(t,i){e.call(this),this.gHelper=t,this.satChainServ=i}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,5e3,400),this.shapeOuter=new createjs.Shape,this.shapeContainer.addChild(this.shapeOuter),this.txtDV1=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDV1.textAlign="left",this.txtDV1.textBaseline="middle",this.txtDV1.x=this.center.x+i.parkingAltitude+t.ViewService.marginText,this.txtDV1.y=this.center.y,this.textContainer.addChild(this.txtDV1),this.txtDV2=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDV2.textAlign="left",this.txtDV2.textBaseline="middle",this.txtDV2.x=this.center.x-i.designatedAltitude+t.ViewService.marginText,this.txtDV2.y=this.center.y,this.textContainer.addChild(this.txtDV2),this.txtDVTotal=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDVTotal.textAlign="center",this.txtDVTotal.textBaseline="top",this.txtDVTotal.x=this.center.x,this.txtDVTotal.y=this.center.y+i.parkingAltitude+t.ViewService.marginText,this.textContainer.addChild(this.txtDVTotal),this.txtPhaseAngle=new createjs.Text("",t.ViewService.fontSetNormal),this.txtPhaseAngle.textAlign="center",this.txtPhaseAngle.textBaseline="bottom",this.txtPhaseAngle.x=this.center.x,this.txtPhaseAngle.y=this.center.y-i.designatedAltitude-t.ViewService.marginText,this.textContainer.addChild(this.txtPhaseAngle),this.txtPhaseTime=new createjs.Text("",t.ViewService.fontSetNormal),this.txtPhaseTime.textAlign="center",this.txtPhaseTime.textBaseline="top",this.txtPhaseTime.x=this.center.x,this.txtPhaseTime.y=this.center.y+i.designatedAltitude+t.ViewService.marginText,this.textContainer.addChild(this.txtPhaseTime),this.show()},i.prototype.show=function(){this.shapeOuter.graphics.clear(),this.shapeOuter.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showFigures(this.shapeOuter.graphics,this.satChainServ),this.update()},i.prototype.showFigures=function(e,n){var a=n.satChain,r=a.body;this.shapeOuter.graphics.beginFill(r.color).drawCircle(this.center.x,this.center.y,i.bodyRadius).endFill(),this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x,this.center.y,i.parkingAltitude).endStroke(),this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x,this.center.y,i.designatedAltitude).endStroke(),this.shapeOuter.graphics.beginStroke("green").arc(this.center.x+(i.parkingAltitude-i.designatedAltitude)/2,this.center.y,(i.parkingAltitude+i.designatedAltitude)/2,0,Math.PI,!0).endStroke(),this.shapeOuter.graphics.beginStroke("green"),this.gHelper.drawArrow(this.shapeOuter.graphics,this.center.x+(i.parkingAltitude-i.designatedAltitude)/2,this.center.y-(i.parkingAltitude+i.designatedAltitude)/2,0,t.ViewService.arrowSize).endStroke(),this.txtDV1.text="Start dV:\n"+(1e3*n.hohmannStartDeltaV()).toLocaleString("en",t.ViewService.localeSetting)+" m/s",this.txtDV2.text="Finish dV:\n"+(1e3*n.hohmannFinishDeltaV()).toLocaleString("en",t.ViewService.localeSetting)+" m/s",this.txtDVTotal.text="Total dV: "+(1e3*(n.hohmannStartDeltaV()+n.hohmannFinishDeltaV())).toLocaleString("en",t.ViewService.localeSetting)+"m/s",this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x-i.designatedAltitude,this.center.y,t.ViewService.dotRadius).endStroke(),this.shapeOuter.graphics.beginFill("black").drawCircle(this.center.x-Math.cos(i.neighborSatInterval)*i.designatedAltitude,this.center.y-Math.sin(i.neighborSatInterval)*i.designatedAltitude,t.ViewService.dotRadius).drawCircle(this.center.x-Math.cos(i.neighborSatInterval)*i.designatedAltitude,this.center.y+Math.sin(i.neighborSatInterval)*i.designatedAltitude,t.ViewService.dotRadius).endFill(),this.txtPhaseAngle.text="Slide angle: "+n.slidePhaseAngle().toLocaleString("en",t.ViewService.localeSetting)+" deg.",this.txtPhaseTime.text="Slide time: "+n.slidePhaseTime().toLocaleString("en",t.ViewService.localeSetting)+" sec."},i.targetCanvas="deltav",i.bodyRadius=20,i.parkingAltitude=50,i.designatedAltitude=150,i.neighborSatInterval=Math.PI/3,i.$inject=["graphicsHelperServ","satChainServ"],i}(t.ViewService);t.DeltavViewService=e}(App||(App={}));var App;!function(t){var e=function(e){function i(t,i){e.call(this),this.gHelper=t,this.satChainServ=i}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,1e4,850),this.shape=new createjs.Shape,this.shapeContainer.addChild(this.shape),this.txtBodyName=new createjs.Text("",t.ViewService.fontSetBig),this.txtBodyName.textAlign="center",this.txtBodyName.textBaseline="middle",this.txtBodyName.x=this.center.x,this.txtBodyName.y=this.center.y,this.textContainer.addChild(this.txtBodyName),this.txtBodySoI=new createjs.Text("",t.ViewService.fontSetNormal),this.txtBodySoI.textAlign="center",this.txtBodySoI.textBaseline="top",this.txtBodySoI.x=this.center.x,this.textContainer.addChild(this.txtBodySoI),this.txtSatAltitude=new createjs.Text("",t.ViewService.fontSetNormal),this.txtSatAltitude.textAlign="center",this.txtSatAltitude.textBaseline="top",this.txtSatAltitude.x=this.center.x,this.textContainer.addChild(this.txtSatAltitude),this.txtCommDistance=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommDistance.textAlign="left",this.txtCommDistance.textBaseline="top",this.textContainer.addChild(this.txtCommDistance),this.txtCommDistance2=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommDistance2.textAlign="right",this.txtCommDistance2.textBaseline="down",this.textContainer.addChild(this.txtCommDistance2),this.txtCommStableRange=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommStableRange.textAlign="center",this.txtCommStableRange.textBaseline="bottom",this.txtCommStableRange.x=this.center.x,this.textContainer.addChild(this.txtCommStableRange),this.show()},i.prototype.show=function(){var e=this.satChainServ.satChain;this.virtualSize=2*(e.body.radius+e.altitude+this.satChainServ.selectedAntenna.range)*1.05,this.shape.graphics.clear(),this.shape.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showSatChain(this.shape.graphics,this.satChainServ),this.showBody(this.shape.graphics,this.satChainServ),this.update()},i.prototype.showBody=function(e,i){var n=i.satChain,a=n.body;e.beginFill(a.color).drawCircle(this.center.x,this.center.y,this.toReal(a.radius)).endFill(),this.txtBodyName.text=a.name,a.soi!=Number.POSITIVE_INFINITY?(e.beginStroke("yellow").drawCircle(this.center.x,this.center.y,this.toReal(a.soi-a.radius)).endStroke(),this.txtBodySoI.text="Sphere of Influence: "+(a.soi-a.radius).toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtBodySoI.y=this.center.y+Math.max(this.toReal(a.soi-a.radius)+t.ViewService.marginText,this.toReal(a.radius+n.altitude)+t.ViewService.marginTextPushed),this.txtBodySoI.visible=!0):this.txtBodySoI.visible=!1},i.prototype.showSatChain=function(e,i){var n=i.satChain,a=n.body,r=this.satChainServ.selectedAntenna;e.beginStroke("black").drawCircle(this.center.x,this.center.y,this.toReal(n.altitude+a.radius)).endStroke(),this.txtSatAltitude.text="Altitude: "+n.altitude.toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtSatAltitude.y=this.center.y+this.toReal(n.altitude+a.radius)+t.ViewService.marginText;for(var s=0;s<n.count;s++)e.beginFill("black").drawCircle(this.center.x+this.toReal(i.satPosition(s).x),this.center.y+this.toReal(i.satPosition(s).y),t.ViewService.dotRadius).endFill();for(var s=0;s<n.count;s++)e.beginFill("rgba(255,0,0,0.1)").drawCircle(this.center.x+this.toReal(i.satPosition(s).x),this.center.y+this.toReal(i.satPosition(s).y),this.toReal(r.range)).endFill();e.beginStroke(i.isNextSatConnectable()?"blue":"red"),this.gHelper.drawDualArrow(this.shape.graphics,this.center.x+this.toReal(i.satPosition(0).x),this.center.y+this.toReal(i.satPosition(0).y),this.center.x+this.toReal(i.satPosition(1).x),this.center.y+this.toReal(i.satPosition(1).y),t.ViewService.arrowSize).endStroke(),this.txtCommDistance.text="Distance: "+i.satDistance().toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommDistance.x=this.center.x+this.toReal((i.satPosition(0).x+i.satPosition(1).x)/2)+t.ViewService.marginText/2,this.txtCommDistance.y=this.center.y+this.toReal((i.satPosition(0).y+i.satPosition(1).y)/2)+t.ViewService.marginText/2,n.count>4?(e.beginStroke(i.canConnectToSat(2)?"blue":"red"),this.gHelper.drawDualArrow(this.shape.graphics,this.center.x+this.toReal(i.satPosition(0).x),this.center.y+this.toReal(i.satPosition(0).y),this.center.x+this.toReal(i.satPosition(2).x),this.center.y+this.toReal(i.satPosition(2).y),t.ViewService.arrowSize).endStroke(),this.txtCommDistance2.text="Distance: "+i.satDistanceTo(2).toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommDistance2.x=this.center.x+this.toReal((i.satPosition(0).x+i.satPosition(2).x)/2)-t.ViewService.marginText/2,this.txtCommDistance2.y=this.center.y+this.toReal((i.satPosition(0).y+i.satPosition(2).y)/2)-t.ViewService.marginText/2,this.txtCommDistance2.visible=!0):this.txtCommDistance2.visible=!1,i.hasStableArea()?(this.shape.graphics.beginStroke("green").drawCircle(this.center.x,this.center.y,this.toReal(i.stableLimitAltitude()+a.radius)).endStroke(),this.txtCommStableRange.text="Stable: "+i.stableLimitAltitude().toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommStableRange.y=this.center.y-this.toReal(i.stableLimitAltitude()+a.radius)-t.ViewService.marginText):this.txtCommStableRange.text=""},i.targetCanvas="entire",i.$inject=["graphicsHelperServ","satChainServ"],i}(t.ViewService);t.EntireViewService=e}(App||(App={}));var App;!function(t){var e=function(){function t(){}return t.prototype.drawArrow=function(e,i,n,a,r){return e.moveTo(i,n).lineTo(i+r*Math.cos(a+t.arrowAngle),n+r*Math.sin(a+t.arrowAngle)).lineTo(i+r*Math.cos(a-t.arrowAngle),n+r*Math.sin(a-t.arrowAngle)).lineTo(i,n),e},t.prototype.drawDualArrow=function(t,e,i,n,a,r){var s=Math.atan2(a-i,n-e);return t.moveTo(e,i).lineTo(n,a),this.drawArrow(t,e,i,s,r),this.drawArrow(t,n,a,s+Math.PI,r),t},t.arrowAngle=Math.PI/6,t.$inject=[],t}();t.GraphicsHelperService=e}(App||(App={}));var App;!function(t){var e=function(e){function i(t){e.call(this),this.satChainServ=t}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,5e3,400),this.shapeOuter=new createjs.Shape,this.shapeContainer.addChild(this.shapeOuter),this.txtOrbitalPeriod=new createjs.Text("",t.ViewService.fontSetNormal),this.txtOrbitalPeriod.textAlign="center",this.txtOrbitalPeriod.textBaseline="bottom",this.txtOrbitalPeriod.x=this.center.x,this.txtOrbitalPeriod.y=this.center.y-i.orbitRadius-t.ViewService.marginText,this.textContainer.addChild(this.txtOrbitalPeriod),this.txtRequiredGenerator=new createjs.Text("",t.ViewService.fontSetNormal),this.txtRequiredGenerator.textAlign="center",this.txtRequiredGenerator.textBaseline="top",this.txtRequiredGenerator.x=this.center.x,this.txtRequiredGenerator.y=this.center.y+i.orbitRadius+t.ViewService.marginText,this.textContainer.addChild(this.txtRequiredGenerator),this.txtNightTime=new createjs.Text("",t.ViewService.fontSetNormal),this.txtNightTime.textAlign="right",this.txtNightTime.textBaseline="bottom",this.txtNightTime.x=this.realSize-t.ViewService.marginText,this.txtNightTime.y=this.center.y-i.bodyRadius-t.ViewService.marginText,this.textContainer.addChild(this.txtNightTime),this.txtRequiredBattery=new createjs.Text("",t.ViewService.fontSetNormal),this.txtRequiredBattery.textAlign="right",this.txtRequiredBattery.textBaseline="top",this.txtRequiredBattery.x=this.realSize-t.ViewService.marginText,this.txtRequiredBattery.y=this.center.y+i.bodyRadius+t.ViewService.marginText,this.textContainer.addChild(this.txtRequiredBattery),this.show()},i.prototype.show=function(){this.shapeOuter.graphics.clear(),this.shapeOuter.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showFigures(this.shapeOuter.graphics,this.satChainServ),this.update()},i.prototype.showFigures=function(e,n){var a=n.satChain,r=a.body;this.shapeOuter.graphics.beginFill("rgba(0,0,0,0.2)").drawRect(this.center.x,this.center.y-i.bodyRadius,this.realSize/2,2*i.bodyRadius).endFill(),this.shapeOuter.graphics.beginFill(r.color).drawCircle(this.center.x,this.center.y,i.bodyRadius).endFill(),this.shapeOuter.graphics.beginStroke("gray").drawCircle(this.center.x,this.center.y,i.orbitRadius).endStroke(),this.txtOrbitalPeriod.text="Orbital period: "+n.orbitalPeriod().toLocaleString("en",t.ViewService.localeSetting)+" sec.",this.txtNightTime.text="Night time: "+n.nightTime().toLocaleString("en",t.ViewService.localeSetting)+" sec.",this.txtRequiredBattery.text="Required Battery: "+n.requiredBattery().toLocaleString("en",t.ViewService.localeSetting),this.txtRequiredGenerator.text="Required Generator: "+n.requiredGenerator().toLocaleString("en",t.ViewService.localeSetting)+" per sec."},i.targetCanvas="night",i.bodyRadius=50,i.orbitRadius=150,i.$inject=["satChainServ"],i}(t.ViewService);t.NightViewService=e}(App||(App={}));var App;!function(t){var e=Calculator.Point,i=function(i){function n(t,e,a,r){i.call(this,t,e,n.defaultData,n.dataKey,n.versionKey,n.modelVersion,n.updater),this.euclideanServ=a,this.orbitalServ=r,this._satChain=this.data}return __extends(n,i),Object.defineProperty(n.prototype,"satChain",{get:function(){return this._satChain},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"selectedAntenna",{get:function(){return this.satChain.antennas[this.satChain.antennaIndex].antenna},enumerable:!0,configurable:!0}),n.updater=function(t,e){return void 0===e&&(t.antennas=[{antenna:t.antenna,quantity:1}],t.antennaIndex=0),t},n.prototype.satPosition=function(t){var i=this.satChain.body.radius+this.satChain.altitude;return new e(i*Math.cos(2*Math.PI/this.satChain.count*t),i*Math.sin(2*Math.PI/this.satChain.count*t))},n.prototype.satDistance=function(){return this.satDistanceTo(1)},n.prototype.satDistanceTo=function(t){return this.euclideanServ.length(this.satPosition(0),this.satPosition(t))},n.prototype.isNextSatConnectable=function(){return this.canConnectToSat(1)},n.prototype.canConnectToSat=function(t){return this.satChain.count>=t+1&&this.euclideanServ.length(this.satPosition(0),this.satPosition(t))<=this.selectedAntenna.range&&this.euclideanServ.distPointLine(new e(0,0),this.satPosition(0),this.satPosition(t))>this.satChain.body.radius},n.prototype.hasStableArea=function(){return this.satChain.count>=3&&this.isNextSatConnectable()},n.prototype.stableLimitAltitude=function(){return this.euclideanServ.circleCross(new e(0,0),this.satPosition(0),this.satPosition(1),this.selectedAntenna.range,0)-this.satChain.body.radius},n.prototype.orbitalPeriod=function(){return this.orbitalServ.period(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity)},n.prototype.nightTime=function(){return this.orbitalServ.nightTime(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity)},n.prototype.totalElcNeeded=function(){var t=this.satChain.elcNeeded;for(var e in this.satChain.antennas){var i=this.satChain.antennas[e];t+=i.antenna.elcNeeded*i.quantity}return t},n.prototype.requiredBattery=function(){return this.totalElcNeeded()*this.nightTime()},n.prototype.requiredGenerator=function(){return this.totalElcNeeded()*this.orbitalPeriod()/(this.orbitalPeriod()-this.nightTime())},n.prototype.hohmannStartDeltaV=function(){return this.orbitalServ.hohmannStartDV(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.altitude,this.satChain.body.stdGravity)},n.prototype.hohmannFinishDeltaV=function(){return this.orbitalServ.hohmannFinishDV(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.altitude,this.satChain.body.stdGravity)},n.prototype.slidePhaseAngle=function(){var t=this.orbitalServ.period(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.body.stdGravity),e=this.orbitalServ.period(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity);return this.orbitalServ.slidePhaseAngle(360/this.satChain.count,t,e)},n.prototype.slidePhaseTime=function(){return this.slidePhaseAngle()/360*this.orbitalServ.period(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.body.stdGravity)},n.defaultData={body:{name:"Kerbin",color:"rgb(63,111,40)",radius:600,stdGravity:3531.6,soi:84159.286},count:4,altitude:1e3,elcNeeded:.029,antennas:[{antenna:{name:"Communotron 16",type:t.AntennaType.omni,range:2500,elcNeeded:.13},quantity:1}],antennaIndex:0,parkingAlt:70},n.dataKey="inputData",n.versionKey="inputDataVersion",n.modelVersion=1,n.$inject=["$cookieStore","localStorageService","calc.euclideanServ","calc.orbitalServ"],n}(t.DataService);t.SatChainService=i}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i){this.entireViewServ=t,this.nightViewServ=e,this.deltavViewServ=i}return t.prototype.initView=function(){this.entireViewServ.init(),this.nightViewServ.init(),this.deltavViewServ.init()},t.prototype.updateView=function(){this.entireViewServ.show(),this.nightViewServ.show(),this.deltavViewServ.show()},t.$inject=["entireViewServ","nightViewServ","deltavViewServ"],t}();t.AppController=e}(App||(App={}));var App;!function(t){var e=function(){function t(t,e){this.bodyDictionaryServ=t,this.satChainServ=e,this.userBodies=t.userBodies,this.satChain=e.satChain,this.isInEdit=!1,this.editData=void 0}return t.prototype.isUsed=function(t){return this.satChain.body.name===t},t.prototype.add=function(){this.editData={name:"",color:"",radius:0,stdGravity:0,soi:0},this.isInEdit=!0},t.prototype.edit=function(t){this.editData=this.bodyDictionaryServ.get(t),this.isInEdit=!0},t.prototype.remove=function(t){this.isInEdit=!1,this.bodyDictionaryServ.remove(t),this.bodyDictionaryServ.save()},t.prototype.save=function(){this.isInEdit=!1,this.bodyDictionaryServ.set(this.editData.name,this.editData),this.bodyDictionaryServ.save()},t.prototype.cancel=function(){this.isInEdit=!1},t.$inject=["bodyDictionaryServ","satChainServ"],t}();t.BodyEditController=e}(App||(App={}));var App;!function(t){var e=function(){function e(t,e){this.antennaDictionaryServ=t,this.satChainServ=e,this.userAntennas=t.userAntennas,this.satChain=e.satChain,this.isInEdit=!1,this.editData=void 0}return e.prototype.isUsed=function(t){var e=!1;for(var i in this.satChain.antennas)this.satChain.antennas[i].antenna.name===t&&(e=!0);return e},e.prototype.add=function(){this.editData={name:"",type:t.AntennaType.omni,range:0,elcNeeded:0},this.isInEdit=!0},e.prototype.edit=function(t){this.editData=this.antennaDictionaryServ.get(t),this.isInEdit=!0},e.prototype.remove=function(t){this.isInEdit=!1,this.antennaDictionaryServ.remove(t),this.antennaDictionaryServ.save()},e.prototype.save=function(){this.isInEdit=!1,this.antennaDictionaryServ.set(this.editData.name,this.editData),this.antennaDictionaryServ.save()},e.prototype.cancel=function(){this.isInEdit=!1},e.$inject=["antennaDictionaryServ","satChainServ"],e}();t.AntennaEditController=e}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i){this.satChainServ=t,this.bodies=e,this.antennas=i,this.satChain=this.satChainServ.satChain,this.bodyDetailVisible=!1,this.antennaDetailVisible=new Array;for(var n=0;n<this.satChain.antennas.length;n++)this.antennaDetailVisible.push(!1)}return t.prototype.save=function(){this.satChainServ.save()},t.prototype.updateBody=function(){var t=this.bodies.get(this.satChain.body.name);this.satChain.body.color=t.color,this.satChain.body.radius=t.radius,this.satChain.body.stdGravity=t.stdGravity,this.satChain.body.soi=t.soi},t.prototype.updateAntenna=function(t){var e=this.antennas.get(this.satChain.antennas[t].antenna.name);this.satChain.antennas[t].antenna.type=e.type,this.satChain.antennas[t].antenna.range=e.range,this.satChain.antennas[t].antenna.elcNeeded=e.elcNeeded},t.prototype.isSelectedAntenna=function(t){return this.satChain.antennaIndex===t},t.prototype.setAntennaIndex=function(t){this.satChain.antennaIndex=t},t.prototype.addNewAntenna=function(){this.satChain.antennas.push({antenna:this.antennas.get("Reflectron DP-10"),quantity:1}),this.antennaDetailVisible.push(!1)},t.prototype.removeSelectedAntenna=function(){this.satChain.antennas.splice(this.satChain.antennaIndex,1),this.antennaDetailVisible.splice(this.satChain.antennaIndex,1),this.satChain.antennaIndex===this.satChain.antennas.length&&this.satChain.antennaIndex--},t.$inject=["satChainServ","bodyDictionaryServ","antennaDictionaryServ"],t}();t.InputController=e}(App||(App={}));var App;!function(t){function e(){return function(t){return"0"===t?"Omnidirectional":"1"===t?"Dish":void 0}}t.antennaType=e}(App||(App={}));var App;!function(t){angular.module("app",["ngCookies","LocalStorageModule","calc"]).config(["localStorageServiceProvider",function(t){t.setPrefix("kspRemoteTechPlanner")}]).service("bodyDictionaryServ",t.BodyDictionaryService).service("antennaDictionaryServ",t.AntennaDictionaryService).service("satChainServ",t.SatChainService).service("graphicsHelperServ",t.GraphicsHelperService).service("entireViewServ",t.EntireViewService).service("nightViewServ",t.NightViewService).service("deltavViewServ",t.DeltavViewService).controller("inputCtrl",t.InputController).controller("bodyEditCtrl",t.BodyEditController).controller("antennaEditCtrl",t.AntennaEditController).controller("appCtrl",t.AppController).filter("antennaType",t.antennaType)
}(App||(App={}));
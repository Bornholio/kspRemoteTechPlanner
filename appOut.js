var Calculator;!function(t){var e=function(){function t(t,e){this.x=t,this.y=e}return t}();t.Point=e}(Calculator||(Calculator={}));var Calculator;!function(t){"use strict";!function(t){t[t.high=0]="high",t[t.low=1]="low"}(t.CircleCrossMode||(t.CircleCrossMode={}));var e=(t.CircleCrossMode,function(){function e(){}return e.prototype.circleCross=function(e,i,n,a,r){var s=this.length(i,n),o=Math.atan2(n.y-i.y,n.x-i.x),h=Math.acos(s/(2*a)),c=new t.Point(i.x+a*Math.cos(o+h),i.y+a*Math.sin(o+h)),l=new t.Point(i.x+a*Math.cos(o-h),i.y+a*Math.sin(o-h));return 0==r?this.length(e,c)>this.length(e,l)?this.length(e,c):this.length(e,l):1==r?this.length(e,c)<this.length(e,l)?this.length(e,c):this.length(e,l):void 0},e.prototype.length=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e.prototype.distPointLine=function(e,i,n){var a=new t.Point(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2);return this.length(e,a)},e}());t.EuclideanService=e}(Calculator||(Calculator={}));var Calculator;!function(t){"use strict";var e=function(){function t(){}return t.prototype.period=function(t,e,i){return 2*Math.PI*Math.sqrt(Math.pow(t+e,3)/i)},t.prototype.nightTime=function(t,e,i){var n=t+e;return 2*Math.pow(n,2)/Math.sqrt(n*i)*Math.asin(t/n)},t.prototype.hohmannStartDV=function(t,e,i,n){var a=t+e,r=t+i;return Math.sqrt(n/a)*(Math.sqrt(2*r/(a+r))-1)},t.prototype.hohmannFinishDV=function(t,e,i,n){var a=t+e,r=t+i;return Math.sqrt(n/r)*(1-Math.sqrt(2*a/(a+r)))},t.prototype.slidePhaseAngle=function(t,e,i){return t/(1-e/i)},t}();t.OrbitalService=e}(Calculator||(Calculator={}));var Calculator;!function(t){angular.module("calc",[]).service("calc.euclideanServ",t.EuclideanService).service("calc.orbitalServ",t.OrbitalService)}(Calculator||(Calculator={}));var App;!function(t){var e=function(){function t(){}return t.omni="0",t.dish="1",t}();t.AntennaType=e;var i=function(){function t(t,e,i,n){this.name=t,this.type=e,this.range=i,this.elcNeeded=n}return t.prototype.clone=function(){return new t(this.name,this.type,this.range,this.elcNeeded)},t}();t.Antenna=i}(App||(App={}));var App;!function(t){var e=function(){function t(t,e){this.antenna=t,this.quantity=e}return Object.defineProperty(t.prototype,"elcNeeded",{get:function(){return this.antenna.elcNeeded*this.quantity},enumerable:!0,configurable:!0}),t}();t.AntennaEquipment=e}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i,n,a){this.name=t,this.color=e,this.radius=i,this.stdGravity=n,this.soi=a}return t.prototype.clone=function(){return new t(this.name,this.color,this.radius,this.stdGravity,this.soi)},t}();t.Body=e}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i,n,a,r,s){this.body=t,this.count=e,this.altitude=i,this.elcNeeded=n,this.antennas=a,this.antennaIndex=r,this.parkingAlt=s}return Object.defineProperty(t.prototype,"selectedAntenna",{get:function(){return this.antennas[this.antennaIndex].antenna},enumerable:!0,configurable:!0}),t}();t.SatChain=e}(App||(App={}));var App;!function(t){function e(t,e){if(void 0===e)for(var i in t)0==t[i].type?t[i].type="0":1==t[i].type&&(t[i].type="1");return t}t.antennaStorageServiceUpdater=e}(App||(App={}));var App;!function(t){function e(e,i){return void 0===i&&(e.antennas=[new t.AntennaEquipment(e.antenna,1)],e.antennaIndex=0),e}t.satChainServiceUpdater=e}(App||(App={}));var App;!function(t){var e=Calculator.Point,i=function(){function t(){}return Object.defineProperty(t.prototype,"center",{get:function(){return new e(this.realSize/2,this.realSize/2)},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,i){this.stage=new createjs.Stage(t),this.shapeContainer=new createjs.Container,this.textContainer=new createjs.Container,this.stage.addChild(this.shapeContainer),this.stage.addChild(this.textContainer),this.virtualSize=e,this.realSize=i},t.prototype.toReal=function(t){return t*this.realSize/this.virtualSize},t.prototype.update=function(){this.stage.update()},t.fontSetNormal="16px Arial",t.fontSetBig="20px Arial",t.localeSetting={maximumFractionDigits:3},t.marginText=8,t.marginTextPushed=24,t.strokeLineWidth=1,t.dotRadius=4,t.arrowSize=16,t}();t.ViewService=i}(App||(App={}));var App;!function(t){var e=function(){function e(i,n){this.$cookieStore=i,this.localStorage=n,this._stockAntennas={"Reflectron DP-10":new t.Antenna("Reflectron DP-10",t.AntennaType.omni,500,.01),"Communotron 16":new t.Antenna("Communotron 16",t.AntennaType.omni,2500,.13),"CommTech EXP-VR-2T":new t.Antenna("CommTech EXP-VR-2T",t.AntennaType.omni,3e3,.18),"Communotron 32":new t.Antenna("Communotron 32",t.AntennaType.omni,5e3,.6),"Comms DTS-M1":new t.Antenna("Comms DTS-M1",t.AntennaType.dish,5e4,.82),"Reflectron KR-7":new t.Antenna("Reflectron KR-7",t.AntennaType.dish,9e4,.82),"Communotron 88-88":new t.Antenna("Communotron 88-88",t.AntennaType.dish,4e7,.93),"Reflectron KR-14":new t.Antenna("Reflectron KR-14",t.AntennaType.dish,6e7,.93),"CommTech-1":new t.Antenna("CommTech-1",t.AntennaType.dish,35e7,2.6),"Reflectron GX-128":new t.Antenna("Reflectron GX-128",t.AntennaType.dish,4e8,2.8)},this._userAntennas=this.loadUserAntennas(),this.localStorage.set(e.versionKey,e.modelVersion)}return Object.defineProperty(e.prototype,"stockAntennas",{get:function(){return this._stockAntennas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userAntennas",{get:function(){return this._userAntennas},enumerable:!0,configurable:!0}),e.prototype.loadUserAntennas=function(){var i=this.localStorage.get(e.dataKey);i||(i=this.$cookieStore.get(e.dataKey),this.$cookieStore.remove(e.dataKey));var n=this.localStorage.get(e.versionKey);if(void 0!==i){var a=t.antennaStorageServiceUpdater(i,n),r={};for(var s in a){var o=i[s];r[o.name]=new t.Antenna(o.name,o.type,o.range,o.elcNeeded)}return r}return{}},e.prototype.save=function(){Object.keys(this.userAntennas).length>0?this.localStorage.set(e.dataKey,this.userAntennas):this.localStorage.remove(e.dataKey)},e.prototype.existsInStock=function(t){return-1!==Object.keys(this.stockAntennas).indexOf(t)},e.prototype.existsInUser=function(t){return-1!==Object.keys(this.userAntennas).indexOf(t)},e.prototype.getAntenna=function(t){return this.existsInStock(t)?this.stockAntennas[t].clone():this.existsInUser(t)?this.userAntennas[t].clone():void 0},e.prototype.setAntenna=function(t,e){this.userAntennas[t]=e.clone()},e.prototype.removeAntenna=function(t){delete this.userAntennas[t]},e.dataKey="userAntenna",e.versionKey="userAntennaVersion",e.modelVersion=1,e.$inject=["$cookieStore","localStorageService"],e}();t.AntennaStorageService=e}(App||(App={}));var App;!function(t){var e=function(){function e(i,n){this.$cookieStore=i,this.localStorage=n,this._stockBodies={Kerbol:new t.Body("Kerbol","rgb(255,242,0)",261600,1172332800,Number.POSITIVE_INFINITY),Moho:new t.Body("Moho","rgb(185,122,87)",250,168.60938,9646.663),Eve:new t.Body("Eve","rgb(163,73,164)",700,8171.7302,85109.365),Gilly:new t.Body("Gilly","rgb(239,228,176)",13,.0082894498,126.12327),Kerbin:new t.Body("Kerbin","rgb(63,111,40)",600,3531.6,84159.286),Mun:new t.Body("Mun","rgb(127,127,127)",200,65.138398,2429.5591),Minmus:new t.Body("Minmus","rgb(153,217,234)",60,1.7658,2247.4284),Duna:new t.Body("Duna","rgb(237,28,36)",320,301.36321,47921.949),Ike:new t.Body("Ike","rgb(127,127,127)",130,18.568369,1049.5989),Dres:new t.Body("Dres","rgb(195,195,195)",138,21.484489,32832.84),Jool:new t.Body("Jool","rgb(92,231,58)",6e3,282528,2455985.2),Laythe:new t.Body("Laythe","rgb(25,55,98)",500,1962,3723.6458),Vall:new t.Body("Vall","rgb(82,133,141)",300,207.4815,2406.4014),Tylo:new t.Body("Tylo","rgb(195,195,195)",600,4523.8934,10856.518),Bop:new t.Body("Bop","rgb(142,106,51)",65,2.4868349,1221.0609),Pol:new t.Body("Pol","rgb(206,211,1)",44,.72170208,1042.1389),Eeloo:new t.Body("Eeloo","rgb(221,221,210)",210,74.410815,119082.94)},this._userBodies=this.loadUserBodies(),this.localStorage.set(e.versionKey,e.modelVersion)}return Object.defineProperty(e.prototype,"stockBodies",{get:function(){return this._stockBodies},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userBodies",{get:function(){return this._userBodies},enumerable:!0,configurable:!0}),e.prototype.loadUserBodies=function(){var i=this.localStorage.get(e.dataKey);i||(i=this.$cookieStore.get(e.dataKey),this.$cookieStore.remove(e.dataKey));this.localStorage.get(e.versionKey);if(void 0!==i){var n={};for(var a in i){var r=i[a];n[r.name]=new t.Body(r.name,r.color,r.radius,r.stdGravity,r.soi)}return n}return{}},e.prototype.save=function(){Object.keys(this.userBodies).length>0?this.localStorage.set(e.dataKey,this.userBodies):this.localStorage.remove(e.dataKey)},e.prototype.existsInStock=function(t){return-1!==Object.keys(this.stockBodies).indexOf(t)},e.prototype.existsInUser=function(t){return-1!==Object.keys(this.userBodies).indexOf(t)},e.prototype.getBody=function(t){return this.existsInStock(t)?this.stockBodies[t].clone():this.existsInUser(t)?this.userBodies[t].clone():void 0},e.prototype.setBody=function(t,e){this.userBodies[t]=e.clone()},e.prototype.removeBody=function(t){delete this.userBodies[t]},e.dataKey="userBody",e.versionKey="userBodyVersion",e.modelVersion=1,e.$inject=["$cookieStore","localStorageService"],e}();t.BodyStorageService=e}(App||(App={}));var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},App;!function(t){var e=function(e){function i(t,i){e.call(this),this.gHelper=t,this.satChainServ=i}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,5e3,400),this.shapeOuter=new createjs.Shape,this.shapeContainer.addChild(this.shapeOuter),this.txtDV1=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDV1.textAlign="left",this.txtDV1.textBaseline="middle",this.txtDV1.x=this.center.x+i.parkingAltitude+t.ViewService.marginText,this.txtDV1.y=this.center.y,this.textContainer.addChild(this.txtDV1),this.txtDV2=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDV2.textAlign="left",this.txtDV2.textBaseline="middle",this.txtDV2.x=this.center.x-i.designatedAltitude+t.ViewService.marginText,this.txtDV2.y=this.center.y,this.textContainer.addChild(this.txtDV2),this.txtDVTotal=new createjs.Text("",t.ViewService.fontSetNormal),this.txtDVTotal.textAlign="center",this.txtDVTotal.textBaseline="top",this.txtDVTotal.x=this.center.x,this.txtDVTotal.y=this.center.y+i.parkingAltitude+t.ViewService.marginText,this.textContainer.addChild(this.txtDVTotal),this.txtPhaseAngle=new createjs.Text("",t.ViewService.fontSetNormal),this.txtPhaseAngle.textAlign="center",this.txtPhaseAngle.textBaseline="bottom",this.txtPhaseAngle.x=this.center.x,this.txtPhaseAngle.y=this.center.y-i.designatedAltitude-t.ViewService.marginText,this.textContainer.addChild(this.txtPhaseAngle),this.txtPhaseTime=new createjs.Text("",t.ViewService.fontSetNormal),this.txtPhaseTime.textAlign="center",this.txtPhaseTime.textBaseline="top",this.txtPhaseTime.x=this.center.x,this.txtPhaseTime.y=this.center.y+i.designatedAltitude+t.ViewService.marginText,this.textContainer.addChild(this.txtPhaseTime),this.show()},i.prototype.show=function(){this.shapeOuter.graphics.clear(),this.shapeOuter.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showFigures(this.shapeOuter.graphics,this.satChainServ),this.update()},i.prototype.showFigures=function(e,n){var a=n.satChain,r=a.body;this.shapeOuter.graphics.beginFill(r.color).drawCircle(this.center.x,this.center.y,i.bodyRadius).endFill(),this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x,this.center.y,i.parkingAltitude).endStroke(),this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x,this.center.y,i.designatedAltitude).endStroke(),this.shapeOuter.graphics.beginStroke("green").arc(this.center.x+(i.parkingAltitude-i.designatedAltitude)/2,this.center.y,(i.parkingAltitude+i.designatedAltitude)/2,0,Math.PI,!0).endStroke(),this.shapeOuter.graphics.beginStroke("green"),this.gHelper.drawArrow(this.shapeOuter.graphics,this.center.x+(i.parkingAltitude-i.designatedAltitude)/2,this.center.y-(i.parkingAltitude+i.designatedAltitude)/2,0,t.ViewService.arrowSize).endStroke(),this.txtDV1.text="Start dV:\n"+(1e3*n.hohmannStartDeltaV()).toLocaleString("en",t.ViewService.localeSetting)+" m/s",this.txtDV2.text="Finish dV:\n"+(1e3*n.hohmannFinishDeltaV()).toLocaleString("en",t.ViewService.localeSetting)+" m/s",this.txtDVTotal.text="Total dV: "+(1e3*(n.hohmannStartDeltaV()+n.hohmannFinishDeltaV())).toLocaleString("en",t.ViewService.localeSetting)+"m/s",this.shapeOuter.graphics.beginStroke("black").drawCircle(this.center.x-i.designatedAltitude,this.center.y,t.ViewService.dotRadius).endStroke(),this.shapeOuter.graphics.beginFill("black").drawCircle(this.center.x-Math.cos(i.neighborSatInterval)*i.designatedAltitude,this.center.y-Math.sin(i.neighborSatInterval)*i.designatedAltitude,t.ViewService.dotRadius).drawCircle(this.center.x-Math.cos(i.neighborSatInterval)*i.designatedAltitude,this.center.y+Math.sin(i.neighborSatInterval)*i.designatedAltitude,t.ViewService.dotRadius).endFill(),this.txtPhaseAngle.text="Slide angle: "+n.slidePhaseAngle().toLocaleString("en",t.ViewService.localeSetting)+" deg.",this.txtPhaseTime.text="Slide time: "+n.slidePhaseTime().toLocaleString("en",t.ViewService.localeSetting)+" sec."},i.targetCanvas="deltav",i.bodyRadius=20,i.parkingAltitude=50,i.designatedAltitude=150,i.neighborSatInterval=Math.PI/3,i.$inject=["graphicsHelperServ","satChainServ"],i}(t.ViewService);t.DeltavViewService=e}(App||(App={}));var App;!function(t){var e=function(e){function i(t,i){e.call(this),this.gHelper=t,this.satChainServ=i}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,1e4,850),this.shape=new createjs.Shape,this.shapeContainer.addChild(this.shape),this.txtBodyName=new createjs.Text("",t.ViewService.fontSetBig),this.txtBodyName.textAlign="center",this.txtBodyName.textBaseline="middle",this.txtBodyName.x=this.center.x,this.txtBodyName.y=this.center.y,this.textContainer.addChild(this.txtBodyName),this.txtBodySoI=new createjs.Text("",t.ViewService.fontSetNormal),this.txtBodySoI.textAlign="center",this.txtBodySoI.textBaseline="top",this.txtBodySoI.x=this.center.x,this.textContainer.addChild(this.txtBodySoI),this.txtSatAltitude=new createjs.Text("",t.ViewService.fontSetNormal),this.txtSatAltitude.textAlign="center",this.txtSatAltitude.textBaseline="top",this.txtSatAltitude.x=this.center.x,this.textContainer.addChild(this.txtSatAltitude),this.txtCommDistance=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommDistance.textAlign="left",this.txtCommDistance.textBaseline="top",this.textContainer.addChild(this.txtCommDistance),this.txtCommDistance2=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommDistance2.textAlign="right",this.txtCommDistance2.textBaseline="down",this.textContainer.addChild(this.txtCommDistance2),this.txtCommStableRange=new createjs.Text("",t.ViewService.fontSetNormal),this.txtCommStableRange.textAlign="center",this.txtCommStableRange.textBaseline="bottom",this.txtCommStableRange.x=this.center.x,this.textContainer.addChild(this.txtCommStableRange),this.show()},i.prototype.show=function(){var e=this.satChainServ.satChain;this.virtualSize=2*(e.body.radius+e.altitude+e.selectedAntenna.range)*1.05,this.shape.graphics.clear(),this.shape.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showSatChain(this.shape.graphics,this.satChainServ),this.showBody(this.shape.graphics,this.satChainServ),this.update()},i.prototype.showBody=function(e,i){var n=i.satChain,a=n.body;e.beginFill(a.color).drawCircle(this.center.x,this.center.y,this.toReal(a.radius)).endFill(),this.txtBodyName.text=a.name,a.soi!=Number.POSITIVE_INFINITY?(e.beginStroke("yellow").drawCircle(this.center.x,this.center.y,this.toReal(a.soi-a.radius)).endStroke(),this.txtBodySoI.text="Sphere of Influence: "+(a.soi-a.radius).toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtBodySoI.y=this.center.y+Math.max(this.toReal(a.soi-a.radius)+t.ViewService.marginText,this.toReal(a.radius+n.altitude)+t.ViewService.marginTextPushed),this.txtBodySoI.visible=!0):this.txtBodySoI.visible=!1},i.prototype.showSatChain=function(e,i){var n=i.satChain,a=n.body,r=n.selectedAntenna;e.beginStroke("black").drawCircle(this.center.x,this.center.y,this.toReal(n.altitude+a.radius)).endStroke(),this.txtSatAltitude.text="Altitude: "+n.altitude.toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtSatAltitude.y=this.center.y+this.toReal(n.altitude+a.radius)+t.ViewService.marginText;for(var s=0;s<n.count;s++)e.beginFill("black").drawCircle(this.center.x+this.toReal(i.satPosition(s).x),this.center.y+this.toReal(i.satPosition(s).y),t.ViewService.dotRadius).endFill();for(var s=0;s<n.count;s++)e.beginFill("rgba(255,0,0,0.1)").drawCircle(this.center.x+this.toReal(i.satPosition(s).x),this.center.y+this.toReal(i.satPosition(s).y),this.toReal(r.range)).endFill();e.beginStroke(i.isNextSatConnectable()?"blue":"red"),this.gHelper.drawDualArrow(this.shape.graphics,this.center.x+this.toReal(i.satPosition(0).x),this.center.y+this.toReal(i.satPosition(0).y),this.center.x+this.toReal(i.satPosition(1).x),this.center.y+this.toReal(i.satPosition(1).y),t.ViewService.arrowSize).endStroke(),this.txtCommDistance.text="Distance: "+i.satDistance().toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommDistance.x=this.center.x+this.toReal((i.satPosition(0).x+i.satPosition(1).x)/2)+t.ViewService.marginText/2,this.txtCommDistance.y=this.center.y+this.toReal((i.satPosition(0).y+i.satPosition(1).y)/2)+t.ViewService.marginText/2,n.count>4?(e.beginStroke(i.canConnectToSat(2)?"blue":"red"),this.gHelper.drawDualArrow(this.shape.graphics,this.center.x+this.toReal(i.satPosition(0).x),this.center.y+this.toReal(i.satPosition(0).y),this.center.x+this.toReal(i.satPosition(2).x),this.center.y+this.toReal(i.satPosition(2).y),t.ViewService.arrowSize).endStroke(),this.txtCommDistance2.text="Distance: "+i.satDistanceTo(2).toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommDistance2.x=this.center.x+this.toReal((i.satPosition(0).x+i.satPosition(2).x)/2)-t.ViewService.marginText/2,this.txtCommDistance2.y=this.center.y+this.toReal((i.satPosition(0).y+i.satPosition(2).y)/2)-t.ViewService.marginText/2,this.txtCommDistance2.visible=!0):this.txtCommDistance2.visible=!1,i.hasStableArea()?(this.shape.graphics.beginStroke("green").drawCircle(this.center.x,this.center.y,this.toReal(i.stableLimitAltitude()+a.radius)).endStroke(),this.txtCommStableRange.text="Stable: "+i.stableLimitAltitude().toLocaleString("en",t.ViewService.localeSetting)+" km",this.txtCommStableRange.y=this.center.y-this.toReal(i.stableLimitAltitude()+a.radius)-t.ViewService.marginText):this.txtCommStableRange.text=""},i.targetCanvas="entire",i.$inject=["graphicsHelperServ","satChainServ"],i}(t.ViewService);t.EntireViewService=e}(App||(App={}));var App;!function(t){var e=function(){function t(){}return t.prototype.drawArrow=function(e,i,n,a,r){return e.moveTo(i,n).lineTo(i+r*Math.cos(a+t.arrowAngle),n+r*Math.sin(a+t.arrowAngle)).lineTo(i+r*Math.cos(a-t.arrowAngle),n+r*Math.sin(a-t.arrowAngle)).lineTo(i,n),e},t.prototype.drawDualArrow=function(t,e,i,n,a,r){var s=Math.atan2(a-i,n-e);return t.moveTo(e,i).lineTo(n,a),this.drawArrow(t,e,i,s,r),this.drawArrow(t,n,a,s+Math.PI,r),t},t.arrowAngle=Math.PI/6,t.$inject=[],t}();t.GraphicsHelperService=e}(App||(App={}));var App;!function(t){var e=function(e){function i(t){e.call(this),this.satChainServ=t}return __extends(i,e),i.prototype.init=function(){e.prototype.init.call(this,i.targetCanvas,5e3,400),this.shapeOuter=new createjs.Shape,this.shapeContainer.addChild(this.shapeOuter),this.txtOrbitalPeriod=new createjs.Text("",t.ViewService.fontSetNormal),this.txtOrbitalPeriod.textAlign="center",this.txtOrbitalPeriod.textBaseline="bottom",this.txtOrbitalPeriod.x=this.center.x,this.txtOrbitalPeriod.y=this.center.y-i.orbitRadius-t.ViewService.marginText,this.textContainer.addChild(this.txtOrbitalPeriod),this.txtRequiredGenerator=new createjs.Text("",t.ViewService.fontSetNormal),this.txtRequiredGenerator.textAlign="center",this.txtRequiredGenerator.textBaseline="top",this.txtRequiredGenerator.x=this.center.x,this.txtRequiredGenerator.y=this.center.y+i.orbitRadius+t.ViewService.marginText,this.textContainer.addChild(this.txtRequiredGenerator),this.txtNightTime=new createjs.Text("",t.ViewService.fontSetNormal),this.txtNightTime.textAlign="right",this.txtNightTime.textBaseline="bottom",this.txtNightTime.x=this.realSize-t.ViewService.marginText,this.txtNightTime.y=this.center.y-i.bodyRadius-t.ViewService.marginText,this.textContainer.addChild(this.txtNightTime),this.txtRequiredBattery=new createjs.Text("",t.ViewService.fontSetNormal),this.txtRequiredBattery.textAlign="right",this.txtRequiredBattery.textBaseline="top",this.txtRequiredBattery.x=this.realSize-t.ViewService.marginText,this.txtRequiredBattery.y=this.center.y+i.bodyRadius+t.ViewService.marginText,this.textContainer.addChild(this.txtRequiredBattery),this.show()},i.prototype.show=function(){this.shapeOuter.graphics.clear(),this.shapeOuter.graphics.setStrokeStyle(t.ViewService.strokeLineWidth),this.showFigures(this.shapeOuter.graphics,this.satChainServ),this.update()},i.prototype.showFigures=function(e,n){var a=n.satChain,r=a.body;this.shapeOuter.graphics.beginFill("rgba(0,0,0,0.2)").drawRect(this.center.x,this.center.y-i.bodyRadius,this.realSize/2,2*i.bodyRadius).endFill(),this.shapeOuter.graphics.beginFill(r.color).drawCircle(this.center.x,this.center.y,i.bodyRadius).endFill(),this.shapeOuter.graphics.beginStroke("gray").drawCircle(this.center.x,this.center.y,i.orbitRadius).endStroke(),this.txtOrbitalPeriod.text="Orbital period: "+n.orbitalPeriod().toLocaleString("en",t.ViewService.localeSetting)+" sec.",this.txtNightTime.text="Night time: "+n.nightTime().toLocaleString("en",t.ViewService.localeSetting)+" sec.",this.txtRequiredBattery.text="Required Battery: "+n.requiredBattery().toLocaleString("en",t.ViewService.localeSetting),this.txtRequiredGenerator.text="Required Generator: "+n.requiredGenerator().toLocaleString("en",t.ViewService.localeSetting)+" per sec."},i.targetCanvas="night",i.bodyRadius=50,i.orbitRadius=150,i.$inject=["satChainServ"],i}(t.ViewService);t.NightViewService=e}(App||(App={}));var App;!function(t){var e=Calculator.Point,i=function(){function i(t,e,n,a){this.$cookieStore=t,this.localStorage=e,this.euclideanServ=n,this.orbitalServ=a,this._satChain=this.loadOrCreate(),this.localStorage.set(i.versionKey,i.modelVersion)}return Object.defineProperty(i.prototype,"satChain",{get:function(){return this._satChain},enumerable:!0,configurable:!0}),i.prototype.loadOrCreate=function(){var e=this.localStorage.get(i.dataKey);e||(e=this.$cookieStore.get(i.dataKey),this.$cookieStore.remove(i.dataKey));var n=this.localStorage.get(i.versionKey);if(void 0!==e){var a=t.satChainServiceUpdater(e,n),r=a.body,s=new Array;for(var o in a.antennas){var h=a.antennas[o],c=h.antenna;s.push(new t.AntennaEquipment(new t.Antenna(c.name,c.type,c.range,c.elcNeeded),h.quantity))}return new t.SatChain(new t.Body(r.name,r.color,r.radius,r.stdGravity,r.soi),a.count,a.altitude,a.elcNeeded,s,a.antennaIndex,a.parkingAlt)}return new t.SatChain(new t.Body("Kerbin","rgb(63,111,40)",600,3531.6,84159.286),4,1e3,.029,[new t.AntennaEquipment(new t.Antenna("Communotron 16",t.AntennaType.omni,2500,.13),1)],0,70)},i.prototype.save=function(){this.localStorage.set(i.dataKey,this.satChain)},i.prototype.satPosition=function(t){var i=this.satChain.body.radius+this.satChain.altitude;return new e(i*Math.cos(2*Math.PI/this.satChain.count*t),+i*Math.sin(2*Math.PI/this.satChain.count*t))},i.prototype.satDistance=function(){return this.satDistanceTo(1)},i.prototype.satDistanceTo=function(t){return this.euclideanServ.length(this.satPosition(0),this.satPosition(t))},i.prototype.isNextSatConnectable=function(){return this.canConnectToSat(1)},i.prototype.canConnectToSat=function(t){return this.satChain.count>=t+1&&this.euclideanServ.length(this.satPosition(0),this.satPosition(t))<=this.satChain.selectedAntenna.range&&this.euclideanServ.distPointLine(new e(0,0),this.satPosition(0),this.satPosition(t))>this.satChain.body.radius},i.prototype.hasStableArea=function(){return this.satChain.count>=3&&this.isNextSatConnectable()},i.prototype.stableLimitAltitude=function(){return this.euclideanServ.circleCross(new e(0,0),this.satPosition(0),this.satPosition(1),this.satChain.selectedAntenna.range,0)-this.satChain.body.radius},i.prototype.orbitalPeriod=function(){return this.orbitalServ.period(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity)},i.prototype.nightTime=function(){return this.orbitalServ.nightTime(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity)},i.prototype.totalElcNeeded=function(){var t=this.satChain.elcNeeded;for(var e in this.satChain.antennas)t+=this.satChain.antennas[e].elcNeeded;return t},i.prototype.requiredBattery=function(){return this.totalElcNeeded()*this.nightTime()},i.prototype.requiredGenerator=function(){return this.totalElcNeeded()*this.orbitalPeriod()/(this.orbitalPeriod()-this.nightTime())},i.prototype.hohmannStartDeltaV=function(){return this.orbitalServ.hohmannStartDV(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.altitude,this.satChain.body.stdGravity)},i.prototype.hohmannFinishDeltaV=function(){return this.orbitalServ.hohmannFinishDV(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.altitude,this.satChain.body.stdGravity)},i.prototype.slidePhaseAngle=function(){var t=this.orbitalServ.period(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.body.stdGravity),e=this.orbitalServ.period(this.satChain.body.radius,this.satChain.altitude,this.satChain.body.stdGravity);return this.orbitalServ.slidePhaseAngle(360/this.satChain.count,t,e)},i.prototype.slidePhaseTime=function(){return this.slidePhaseAngle()/360*this.orbitalServ.period(this.satChain.body.radius,this.satChain.parkingAlt,this.satChain.body.stdGravity)},i.dataKey="inputData",i.versionKey="inputDataVersion",i.modelVersion=1,i.$inject=["$cookieStore","localStorageService","calc.euclideanServ","calc.orbitalServ"],i}();t.SatChainService=i}(App||(App={}));var App;!function(t){var e=function(){function t(t,e,i){this.entireViewServ=t,this.nightViewServ=e,this.deltavViewServ=i}return t.prototype.initView=function(){this.entireViewServ.init(),this.nightViewServ.init(),this.deltavViewServ.init()},t.prototype.updateView=function(){this.entireViewServ.show(),this.nightViewServ.show(),this.deltavViewServ.show()},t.$inject=["entireViewServ","nightViewServ","deltavViewServ"],t}();t.AppController=e}(App||(App={}));var App;!function(t){var e=function(){function e(t){this.bodyStorageServ=t,this.userBodies=t.userBodies,this.isInEdit=!1,this.editData=void 0}return e.prototype.exists=function(t){return this.bodyStorageServ.existsInStock(t)||this.bodyStorageServ.existsInUser(t)},e.prototype.add=function(){this.editData=new t.Body("","",0,0,0),this.isInEdit=!0},e.prototype.edit=function(t){this.editData=this.bodyStorageServ.getBody(t),this.isInEdit=!0},e.prototype.remove=function(t){this.isInEdit=!1,this.bodyStorageServ.removeBody(t),this.bodyStorageServ.save()},e.prototype.save=function(){this.isInEdit=!1,this.bodyStorageServ.setBody(this.editData.name,this.editData),this.bodyStorageServ.save()},e.prototype.cancel=function(){this.isInEdit=!1},e.$inject=["bodyStorageServ"],e}();t.BodyEditController=e}(App||(App={}));var App;!function(t){var e=function(){function e(t){this.antennaStorageServ=t,this.userAntennas=t.userAntennas,this.isInEdit=!1,this.editData=void 0}return e.prototype.exists=function(t){return this.antennaStorageServ.existsInStock(t)||this.antennaStorageServ.existsInUser(t)},e.prototype.add=function(){this.editData=new t.Antenna("",t.AntennaType.omni,0,0),this.isInEdit=!0},e.prototype.edit=function(t){this.editData=this.antennaStorageServ.getAntenna(t),this.isInEdit=!0},e.prototype.remove=function(t){this.isInEdit=!1,this.antennaStorageServ.removeAntenna(t),this.antennaStorageServ.save()},e.prototype.save=function(){this.isInEdit=!1,this.antennaStorageServ.setAntenna(this.editData.name,this.editData),this.antennaStorageServ.save()},e.prototype.cancel=function(){this.isInEdit=!1},e.$inject=["antennaStorageServ"],e}();t.AntennaEditController=e}(App||(App={}));var App;!function(t){var e=function(){function e(t,e,i){this.satChainServ=t,this.bodies=e,this.antennas=i,this.satChain=this.satChainServ.satChain,this.bodyDetailVisible=!1,this.antennaDetailVisible=new Array;for(var n=0;n<this.satChain.antennas.length;n++)this.antennaDetailVisible.push(!1)}return e.prototype.save=function(){this.satChainServ.save()},e.prototype.updateBody=function(){var t=this.bodies.getBody(this.satChain.body.name);this.satChain.body.color=t.color,this.satChain.body.radius=t.radius,this.satChain.body.stdGravity=t.stdGravity,this.satChain.body.soi=t.soi},e.prototype.updateAntenna=function(t){var e=this.antennas.getAntenna(this.satChain.antennas[t].antenna.name);this.satChain.antennas[t].antenna.type=e.type,this.satChain.antennas[t].antenna.range=e.range,this.satChain.antennas[t].antenna.elcNeeded=e.elcNeeded},e.prototype.isSelectedAntenna=function(t){return this.satChain.antennaIndex===t},e.prototype.setAntennaIndex=function(t){this.satChain.antennaIndex=t},e.prototype.addNewAntenna=function(){this.satChain.antennas.push(new t.AntennaEquipment(this.antennas.getAntenna("Reflectron DP-10"),1)),this.antennaDetailVisible.push(!1)},e.prototype.removeSelectedAntenna=function(){this.satChain.antennaIndex===this.satChain.antennas.length-1&&this.satChain.antennaIndex--,this.satChain.antennas.splice(this.satChain.antennaIndex,1),this.antennaDetailVisible.splice(this.satChain.antennaIndex,1)},e.$inject=["satChainServ","bodyStorageServ","antennaStorageServ"],e}();t.InputController=e}(App||(App={}));var App;!function(t){function e(){return function(t){return"0"===t?"Omnidirectional":"1"===t?"Dish":void 0}}t.antennaType=e}(App||(App={}));var App;!function(t){angular.module("app",["ngCookies","LocalStorageModule","calc"]).config(["localStorageServiceProvider",function(t){t.setPrefix("kspRemoteTechPlanner")}]).service("bodyStorageServ",t.BodyStorageService).service("antennaStorageServ",t.AntennaStorageService).service("satChainServ",t.SatChainService).service("graphicsHelperServ",t.GraphicsHelperService).service("entireViewServ",t.EntireViewService).service("nightViewServ",t.NightViewService).service("deltavViewServ",t.DeltavViewService).controller("inputCtrl",t.InputController).controller("bodyEditCtrl",t.BodyEditController).controller("antennaEditCtrl",t.AntennaEditController).controller("appCtrl",t.AppController).filter("antennaType",t.antennaType)}(App||(App={}));